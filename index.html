<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<title>OpenAI Transcriber v3.8</title>
<meta name="viewport" content="width=device-width,initial-scale=1" />

<!-- PWA -->
<link rel="manifest" href="manifest.json">
<link rel="apple-touch-icon" href="icons/icon-180.png">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">

<!-- ──────────  libs  ────────── -->
<script src="https://cdn.jsdelivr.net/npm/onnxruntime-web@1.17.1/dist/ort.min.js"></script>
<script>ort.env.wasm.numThreads = 1; ort.env.logLevel = 'error';</script>

<script src="https://cdn.jsdelivr.net/npm/@ricky0123/vad/dist/index.browser.js"></script>
<link  href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
       rel="stylesheet"/>

<!-- ──────────  style  ────────── -->
<link rel="stylesheet" href="style.css">
</head>

<body>
<!-- トグルボタン -->
<button id="toggle">
  <i class="fas fa-bars"></i>
</button>

<!-- ── sidebar ───────────────────────── -->
<aside id="sidebar">
  <header></header>

  <nav id="menu">
    <div class="menu-item" data-act="record"><i class="fa-solid fa-microphone"></i><span>文字起こし</span></div>
    <div class="menu-item" data-act="proofread"><i class="fa-solid fa-spell-check"></i><span>校正</span></div>
    <div class="menu-item" data-act="download"><i class="fa-solid fa-copy"></i><span>コピー</span></div>
    <div class="menu-item" data-act="audio"><i class="fa-solid fa-download"></i><span>音声DL</span></div>
    <div class="menu-item" data-act="settings"><i class="fa-solid fa-gear"></i><span>設定</span></div>

    <!-- ─ history moved here ─ -->
    <div id="history">
      <div id="histHeader">履歴
        <button id="clearAll"><i class="fa-solid fa-trash"></i></button>
      </div>
      <ul id="histList"></ul>
    </div>
  </nav>
</aside>

<!-- 背景カーテン -->
<div id="backdrop"></div>

<!-- ── main ──────────────────────────── -->
<section id="main">
  <!-- ── ヘッダ ── -->
  <div class="section header">
    <span id="logo">Transcriber</span>
    <label class="switch">
      <input id="modeToggle" type="checkbox"><span class="slider"></span>
    </label>
    <!-- auto / manual 表示を修正 -->
    <span id="modeLabel">auto</span>
    <!-- 右上：録音制御  -->
    <div class="rec-ctl">
      <button id="recordBtn" class="icon-btn" aria-label="録音開始">
        <svg width="18" height="18" viewBox="0 0 18 18" fill="none"
             xmlns="http://www.w3.org/2000/svg">
          <path d="M11.165 4.417C11.165 3.22 10.195 2.25 8.999 2.25S6.832 3.22 6.832 4.417v3.75c0 1.197.97 2.167 2.167 2.167 1.196 0 2.166-.97 2.166-2.167v-3.75Z" fill="currentColor"/>
          <path d="M14.806 9.114c-.397-.118-.815.108-.934.505-.625 2.1-2.571 3.63-4.873 3.63-2.302 0-4.248-1.53-4.873-3.63-.118-.397-.536-.623-.933-.505Z" fill="currentColor"/>
        </svg>
      </button>
      <button id="finishBtn" class="icon-btn rec-only" aria-label="録音を確定" hidden>
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path fill-rule="evenodd" clip-rule="evenodd" d="M18.063 5.674a.75.75 0 0 1 .263 1.389l-7.5 11a.75.75 0 0 1-1.176.104l-4.5-4.5a.75.75 0 1 1 1.06-1.06l3.91 3.909 7.037-10.322a.75.75 0 0 1 1.906-.52Z" fill="currentColor"/>
        </svg>
      </button>
      <button id="cancelBtn" class="icon-btn rec-only" aria-label="録音をキャンセル" hidden>
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M5.47 4.47a.75.75 0 0 1 1.06 0L12 9.94l5.47-5.47a.75.75 0 1 1 1.06 1.06L13.06 11l5.47 5.47a.75.75 0 1 1-1.06 1.06L12 12.06l-5.47 5.47a.75.75 0 0 1-1.06-1.06L10.94 11 5.47 5.53a.75.75 0 0 1 0-1.06Z" fill="currentColor"/>
        </svg>
      </button>
    </div>
  </div>
  <div <div class="section content">
    <div id="counter"></div>        <!-- ← 復活させた残り時間表示 -->
    <div id="result" class="box"></div>
    <audio id="player" controls></audio>
  </div>
</section>

<!-- Floating recPanel removed because controls moved to header -->

<!-- ── modal ─────────────────────────── -->
<div id="modal" class="modal">
  <div class="modal-box">
    <h3>OpenAI APIキー</h3>
    <input id="apiKey" type="password" placeholder="sk-…" />
    <button id="saveKey">保存</button>
  </div>
</div>

<!-- DOM が構築されてから JS を実行 -->
<script type="module" defer src="app.js"></script>
</body>
</html>
